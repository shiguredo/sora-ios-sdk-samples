name: Build DataChannelSample

defaults:
  run:
    working-directory: ./DataChannelSample

on:
  push:
    paths-ignore:
    - 'README.md'
    - 'CHANGES.md'
    - 'LICENSE'
  schedule:
  - cron: "0 0 * * *"

jobs:
  build:
    runs-on: macos-12
    env:
      XCODE: /Applications/Xcode_14.0.app
      XCODE_SDK: iphoneos16.0
      WORKSPACE: DataChannelSample
      SCHEME: DataChannelSample
    steps:
    - uses: actions/checkout@v3
    - name: Select Xcode Version
      run: sudo xcode-select -s '${{ env.XCODE }}/Contents/Developer'
    - name: Show Xcode Version
      run: xcodebuild -version
    - name: Show CocoaPods Version
      run: pod --version
    - name: Restore Pods
      uses: actions/cache@v3
      with:
        path: Pods
        key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
        restore-keys: |
          ${{ runner.os }}-pods-
    - name: Install Dependences
      run: |
        pod repo update
        pod install
    - name: Create Environment.swift
      run: |
        cp DataChannelSample/Environment.example.swift DataChannelSample/Environment.swift
    - name: Build Xcode Project
      run: |
        set -o pipefail && \
          xcodebuild \
            -workspace '${{ env.WORKSPACE }}.xcworkspace' \
            -scheme '${{ env.SCHEME }}' \
            -sdk ${{ env.XCODE_SDK }} \
            -arch arm64 \
            -configuration Release \
            -derivedDataPath build \
            clean build \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGNING_ALLOWED=NO \
            CODE_SIGN_IDENTITY= \
            PROVISIONING_PROFILE=
    - name: Check uncommitted unformatted code
      run: |
        ../lint-format.sh